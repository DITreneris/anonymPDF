(venv) PS C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF> pytest
================================================= test session starts =================================================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0
rootdir: C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collected 275 items

tests\test_analytics_api.py .......................                                                              [  8%]
tests\test_analytics_engine.py ......                                                                            [ 10%]
tests\test_config_manager.py ...                                                                                 [ 11%]
tests\test_feedback_system.py ....                                                                               [ 13%]
tests\test_intelligent_cache.py .............................                                                    [ 23%]
tests\test_lithuanian_pii.py .FFFFFF.......                                                                      [ 28%]
tests\test_memory_optimizer.py ......................                                                            [ 36%]
tests\test_ml_integration_layer.py .........                                                                     [ 40%]
tests\test_pdf_processor.py FFFFFF                                                                               [ 42%]
tests\test_performance.py ........                                                                               [ 45%]
tests\test_performance_enhanced.py .......                                                                       [ 47%]
tests\test_performance_optimizer.py ........................                                                     [ 56%]
tests\test_pii_patterns.py ......                                                                                [ 58%]
tests\test_priority2_enhancements.py .........FFFF................                                               [ 69%]
tests\test_real_time_monitor.py .......                                                                          [ 71%]
tests\test_training_data_collector.py .........                                                                  [ 74%]
tests\test_validation_utils.py ........................                                                          [ 83%]
tests\adaptive\test_ab_testing.py ........                                                                       [ 86%]
tests\adaptive\test_doc_classifier.py ........                                                                   [ 89%]
tests\adaptive\test_online_learner.py ....                                                                       [ 90%]
tests\adaptive\test_pattern_db.py .....                                                                          [ 92%]
tests\adaptive\test_pattern_learner.py .

====================================================== FAILURES =======================================================
_____________________ TestLithuanianIntegration.test_comprehensive_lithuanian_document_processing _____________________
tests\test_lithuanian_pii.py:66: in test_comprehensive_lithuanian_document_processing
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 08:00:23,129 - config_manager - INFO - Loading default patterns because file was not found or failed to load.
2025-06-21 08:00:23,145 - config_manager - INFO - Patterns saved successfully - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmp_t0k8i36\\test_config\\patterns.yaml"}
2025-06-21 08:00:23,145 - config_manager - INFO - Cities file not found, creating default - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmp_t0k8i36\\test_config\\cities.yaml"}
2025-06-21 08:00:23,161 - config_manager - INFO - Cities saved successfully - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmp_t0k8i36\\test_config\\cities.yaml", "cities_count": 81}
2025-06-21 08:00:23,167 - config_manager - INFO - Settings loaded from file - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmp_t0k8i36\\test_config\\settings.yaml"}
2025-06-21 08:00:23,167 - config_manager - INFO - Brand names file not found, creating default - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmp_t0k8i36\\test_config\\brand_names.yaml"}
2025-06-21 08:00:23,167 - config_manager - INFO - Saved brand names to file - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmp_t0k8i36\\test_config\\brand_names.yaml"}
2025-06-21 08:00:23,167 - config_manager - INFO - Configuration manager initialized - {"config_dir": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmp_t0k8i36\\test_config", "patterns_count": 38, "cities_count": 81}
2025-06-21 08:00:23,167 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 08:00:23,167 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 08:00:23,167 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 08:00:23,847 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 08:00:24,656 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:24,664 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
__________________________ TestLithuanianIntegration.test_simple_lithuanian_names_detection ___________________________
tests\test_lithuanian_pii.py:79: in test_simple_lithuanian_names_detection
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:25,408 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
_______________________ TestLithuanianIntegration.test_contextual_validation_of_technical_terms _______________________
tests\test_lithuanian_pii.py:87: in test_contextual_validation_of_technical_terms
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:25,471 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
_______________________ TestLithuanianIntegration.test_anti_overredaction_in_technical_context ________________________
tests\test_lithuanian_pii.py:94: in test_anti_overredaction_in_technical_context
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:25,540 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
__________________________ TestLithuanianIntegration.test_anti_overredaction_of_common_words __________________________
tests\test_lithuanian_pii.py:101: in test_anti_overredaction_of_common_words
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:25,609 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
_____________________________ TestLithuanianIntegration.test_redaction_report_generation ______________________________
tests\test_lithuanian_pii.py:118: in test_redaction_report_generation
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:25,671 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
____________________________________ TestPDFProcessorUnit.test_find_personal_info _____________________________________
tests\test_pdf_processor.py:100: in test_find_personal_info
    detections = pdf_processor.find_personal_info(text, language="en")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:27,075 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "en"}
__________________________ TestPDFProcessorUnit.test_deduplicate_with_confidence_simplified ___________________________
tests\test_pdf_processor.py:130: in test_deduplicate_with_confidence_simplified
    final_detections = pdf_processor.deduplicate_with_confidence({}, context_detections=context_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
_________________________________ TestPDFProcessorUnit.test_generate_redaction_report _________________________________
tests\test_pdf_processor.py:156: in test_generate_redaction_report
    assert report["categories"]["NAMES"] == 1
E   KeyError: 'NAMES'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:27,207 - anonympdf.pdf - INFO - Redaction report generated - {"total_redactions": 2, "language": "en"}
________________________________ TestPDFProcessorIntegration.test_process_pdf_success _________________________________
tests\test_pdf_processor.py:181: in test_process_pdf_success
    assert result['status'] == 'processed'
E   AssertionError: assert 'error' == 'processed'
E     - processed
E     + error
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:28,432 - anonympdf.pdf - INFO - Language detected - {"language": "et", "sample_length": 26}
2025-06-21 08:00:28,432 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "et"}
2025-06-21 08:00:28,432 - anonympdf.pdf - ERROR - Error processing PDF - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\pytest-of-tomas\\pytest-240\\test_process_pdf_success0\\test.pdf", "error": "'DetectionContext' object has no attribute 'start'", "exc_info": true}
2025-06-21 08:00:28,432 - anonympdf.performance - INFO - File processing completed: pdf_processing - {"file_size_mb": 5.054473876953125e-05, "duration": 1.2029802799224854, "throughput": 4.2016265447666464e-05, "memory_delta": 24.6171875}
_______________________ TestPDFProcessorIntegration.test_process_pdf_failure_on_invalid_content _______________________
tests\test_pdf_processor.py:201: in test_process_pdf_failure_on_invalid_content
    assert result['status'] == 'failed'
E   AssertionError: assert 'error' == 'failed'
E     - failed
E     + error
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:00:28,494 - anonympdf.pdf - INFO - Language detected - {"language": "en", "sample_length": 9}
2025-06-21 08:00:28,494 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "en"}
2025-06-21 08:00:28,494 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.0, "memory_delta": 0.0}
2025-06-21 08:00:28,510 - anonympdf.performance - INFO - File processing completed: pdf_processing - {"file_size_mb": 9.5367431640625e-06, "duration": 0.03124260902404785, "throughput": 0.0003052479758243603, "memory_delta": 0.0}
_________________________________ TestPDFProcessorIntegration.test_anonymize_pdf_flow _________________________________
tests\test_pdf_processor.py:224: in test_anonymize_pdf_flow
    mock_extract.assert_called_once_with(input_pdf_path)
..\..\..\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:950: in assert_called_once_with
    raise AssertionError(msg)
E   AssertionError: Expected 'extract_text_from_pdf' to be called once. Called 0 times.
_____________________________ TestAdvancedPatternRefinement.test_enhanced_email_detection _____________________________
tests\test_priority2_enhancements.py:134: in test_enhanced_email_detection
    email_detections = [d for d in detections if d['pattern_name'] == 'email_contextual']
tests\test_priority2_enhancements.py:134: in <listcomp>
    email_detections = [d for d in detections if d['pattern_name'] == 'email_contextual']
E   KeyError: 'pattern_name'
_____________________________ TestAdvancedPatternRefinement.test_enhanced_phone_detection _____________________________
tests\test_priority2_enhancements.py:145: in test_enhanced_phone_detection
    assert len(phone_detections) == 1
E   assert 0 == 1
E    +  where 0 = len([])
_________________________ TestAdvancedPatternRefinement.test_enhanced_personal_code_detection _________________________
tests\test_priority2_enhancements.py:154: in test_enhanced_personal_code_detection
    code_detections = [d for d in detections if d['pattern_name'] == 'lithuanian_personal_code_contextual']
tests\test_priority2_enhancements.py:154: in <listcomp>
    code_detections = [d for d in detections if d['pattern_name'] == 'lithuanian_personal_code_contextual']
E   KeyError: 'pattern_name'
____________________________ TestAdvancedPatternRefinement.test_enhanced_address_detection ____________________________
tests\test_priority2_enhancements.py:165: in test_enhanced_address_detection
    assert len(address_detections) == 1
E   assert 0 == 1
E    +  where 0 = len([])
================================================== warnings summary ===================================================
tests/adaptive/test_ab_testing.py::TestABTestManager::test_record_and_evaluate_metrics_variant_wins
  C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF\venv\Lib\site-packages\scipy\stats\_axis_nan_policy.py:586: RuntimeWarning: Precision loss occurred in moment calculation due to catastrophic cancellation. This occurs when the data are nearly identical. Results may be unreliable.
    res = hypotest_fun_out(*samples, **kwds)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.11.9-final-0 -----------
Name                                    Stmts   Miss  Cover   Missing
---------------------------------------------------------------------
app\__init__.py                             0      0   100%
app\api\__init__.py                         0      0   100%
app\api\endpoints\__init__.py               0      0   100%
app\api\endpoints\analytics.py            258     59    77%   32-35, 40-43, 48-51, 56-59, 192-194, 230-232, 250-252, 286-288, 304-306, 357-359, 389-391, 420-423, 446-448, 458-460, 467, 500-503, 561-566, 597, 600-603
app\api\endpoints\feedback.py              48     26    46%   41-92
app\api\endpoints\monitoring.py            10      2    80%   14, 21
app\api\endpoints\pdf.py                  101     66    35%   27, 36-100, 106-107, 113-124, 130-163, 171, 176-182, 188-201
app\core\__init__.py                        0      0   100%
app\core\adaptive\__init__.py               0      0   100%
app\core\adaptive\ab_testing.py           145     10    93%   92-94, 182, 219-220, 256, 329-331
app\core\adaptive\coordinator.py          125     83    34%   25-32, 55-65, 95-128, 133, 137, 156-189, 212-219, 226, 230-231, 235-236, 247-266, 270-273
app\core\adaptive\doc_classifier.py        44      1    98%   84
app\core\adaptive\online_learner.py        31      5    84%   45-46, 66-68
app\core\adaptive\pattern_db.py           125     39    69%   47-51, 83-90, 119-121, 125-127, 144-145, 201-204, 220-221, 242-247, 251, 258-264
app\core\adaptive\pattern_learner.py       64     22    66%   20, 53-103, 117, 123
app\core\adaptive\processing_rules.py      54     11    80%   46-47, 64-65, 82-89, 94
app\core\analytics_engine.py              214     46    79%   102-104, 195-196, 222-227, 231-256, 260-275, 288-289, 318-320, 340-353, 398-401, 405, 409-411, 416
app\core\config_manager.py                262    125    52%   60-61, 78-79, 132-138, 155-156, 162-163, 263-267, 379, 441-443, 465-467, 476-478, 482-493, 497-512, 516-540, 544-584, 588-663, 667
app\core\context_analyzer.py              216     24    89%   56, 71, 76-78, 84, 198-204, 331-332, 445, 452, 455, 486, 488, 533, 569-579
app\core\data_models.py                    45      9    80%   47-51, 56-59
app\core\dependencies.py                  150     76    49%   29-31, 58-60, 88-90, 113-114, 116, 123, 129-151, 155-187, 201-207, 216-231, 238-243, 254-263, 269-280
app\core\feature_engineering.py           332     79    76%   21, 70, 75, 100, 131, 138-143, 159, 200, 238-239, 243-256, 278-279, 287, 315, 333, 340-341, 359, 393-399, 419, 482, 496, 511-521, 527, 534-536, 540, 546, 562-576, 652-653, 657-660, 695-715, 720-729
app\core\feedback_system.py               272    103    62%   27-28, 101-115, 131-166, 178-221, 254-258, 271-272, 281-282, 287, 290, 305, 349-358, 361, 398-400, 407-409, 414, 422-427, 433-436, 469-473, 481, 511-513, 538-556, 560-567
app\core\intelligent_cache.py             373     31    92%   114-115, 135-141, 333-340, 359-360, 396, 413, 443, 445, 460-461, 490, 525-526, 546, 582-583, 596-600, 625-626, 670, 708
app\core\lithuanian_enhancements.py       124     16    87%   277, 323, 341-342, 360-361, 364-365, 368-369, 394-395, 465, 503-505
app\core\logging.py                       110     26    76%   44-55, 59-71, 87, 98, 104, 106, 196-216
app\core\memory_optimizer.py              297     51    83%   91-97, 102, 144, 241-242, 297, 329, 337, 351-356, 373-375, 421, 445, 460-476, 484-485, 525-563, 571-573, 585-586, 606-607
app\core\memory_utils.py                   23      9    61%   15, 20, 25, 30, 42-44, 49-50
app\core\ml_engine.py                     244    153    37%   33, 53-74, 83, 86, 89-90, 96-98, 102-130, 175-179, 183-209, 217, 221, 234-238, 265-322, 331-339, 345-356, 360-374, 386-451, 456-472, 476-481, 499-523
app\core\ml_integration.py                202     85    58%   20, 60, 75, 114-117, 166-168, 176-177, 181-183, 190-233, 239-261, 265-269, 277, 296, 308-352, 404-426, 430-446, 458-460, 464-466, 470-471, 477
app\core\ml_monitoring.py                 280    166    41%   39-56, 73, 114-124, 128-179, 248-251, 255-289, 293-313, 317-334, 338-386, 453-466, 470-475, 479-502, 506-507, 525-548, 552-567, 571-580, 586, 590, 594-618, 622, 626, 630-631, 635-637, 641-645, 651
app\core\ml_training_pipeline.py          147     82    44%   65-67, 82, 89-93, 107-132, 136, 140-145, 152, 166-198, 208-213, 227-244, 251-254, 258-275, 280
app\core\nlp_loader.py                     19     19     0%   1-36
app\core\performance.py                   191     19    90%   93, 153, 188, 220, 271-279, 314, 329-330, 336-340, 365, 369
app\core\performance_optimizer.py         393     98    75%   98-106, 118, 122-123, 176-177, 213, 235, 256-319, 336, 389-395, 416-417, 450-451, 486-489, 570-571, 588-589, 610-616, 632-633, 686, 708-719, 728-766, 807-837, 841-843, 847-863, 877
app\core\real_time_monitor.py             310    174    44%   72, 108-110, 145-147, 166-168, 224-225, 239-251, 293-326, 330-336, 340-345, 349-381, 393-453, 457-525, 529-530, 534-538, 542-549, 553-556, 560-563, 571-582, 586-600, 604-641, 645-650, 654-655, 659-660
app\core\salutation_detector.py           143    113    21%   38-40, 44, 89, 100, 117-140, 144-185, 195-231, 236-252, 256-267, 272-304, 308-333, 341-354, 361-390
app\core\text_extraction.py               120     92    23%   50-106, 110-127, 131-166, 170-175, 180-222, 227-258, 263-282, 290-318, 322-323, 339
app\core\training_data.py                 305    139    54%   43, 68-70, 82, 103-104, 109, 130-131, 138, 174-175, 182, 224-226, 254-271, 275-280, 292-333, 345-383, 432-452, 456-508, 513-530, 534-568, 572-620, 658-665, 704, 745-778, 784
app\core\validation_utils.py              188     38    80%   123-127, 137, 170-171, 186, 202, 208-213, 219-225, 241-250, 270, 275-280, 303-307, 311-315, 360-361, 366-367, 377-378, 490-499
app\database.py                            12      0   100%
app\db\migrations.py                      100     46    54%   26, 48-112, 130-131, 136-138, 160-165, 169-185, 196-197
app\dependencies.py                        25      8    68%   20, 26, 35-36, 41-45
app\main.py                                82     41    50%   26-27, 31-33, 39-50, 81-84, 90-91, 97, 102, 107, 120-153
app\models\pdf_document.py                 21      0   100%
app\pdf_processor.py                       19     13    32%   19-33
app\schemas\pdf.py                         18      0   100%
app\services\__init__.py                    0      0   100%
app\services\pdf_processor.py             291    141    52%   77, 102-164, 185-187, 203, 292-293, 321-339, 360-377, 387-396, 405-438, 444-448, 456-528, 544, 549-550, 564, 574, 598-600, 616, 627-631, 638, 645-653, 665-669
app\version.py                              1      0   100%
app\worker.py                              58     38    34%   45-55, 63-115
---------------------------------------------------------------------
TOTAL                                    6592   2384    64%

FAIL Required test coverage of 80% not reached. Total coverage: 63.83%
================================================ slowest 10 durations =================================================
81.98s setup    tests/adaptive/test_pattern_learner.py::TestValidateRegex::test_perfect_match
5.87s call     tests/test_performance_optimizer.py::TestIntegration::test_performance_improvement_simulation
4.66s call     tests/test_feedback_system.py::TestFeedbackSystemIntegration::test_feedback_submission_flow_is_deterministic
3.52s setup    tests/test_training_data_collector.py::TestTrainingDataCollector::test_get_balanced_training_set_with_data
3.28s setup    tests/test_training_data_collector.py::TestTrainingDataCollector::test_get_balanced_training_set_empty
3.19s setup    tests/test_training_data_collector.py::TestTrainingDataCollector::test_collector_initialization
3.04s setup    tests/test_training_data_collector.py::TestTrainingDataCollector::test_collect_all_training_data_empty_storage
2.89s setup    tests/test_training_data_collector.py::TestTrainingDataCollector::test_collect_all_training_data_with_examples_in_storage
1.78s call     tests/test_performance_optimizer.py::TestParallelProcessor::test_process_batch_with_process_pool
1.54s setup    tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_comprehensive_lithuanian_document_processing
=============================================== short test summary info ===============================================
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_comprehensive_lithuanian_document_processing - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_simple_lithuanian_names_detection - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_contextual_validation_of_technical_terms - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_anti_overredaction_in_technical_context - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_anti_overredaction_of_common_words - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_redaction_report_generation - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_pdf_processor.py::TestPDFProcessorUnit::test_find_personal_info - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_pdf_processor.py::TestPDFProcessorUnit::test_deduplicate_with_confidence_simplified - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_pdf_processor.py::TestPDFProcessorUnit::test_generate_redaction_report - KeyError: 'NAMES'
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_process_pdf_success - AssertionError: assert 'error' == 'processed'
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_process_pdf_failure_on_invalid_content - AssertionError: assert 'error' == 'failed'
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_anonymize_pdf_flow - AssertionError: Expected 'extract_text_from_pdf' to be called once. Called 0 times.
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_email_detection - KeyError: 'pattern_name'
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_phone_detection - assert 0 == 1
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_personal_code_detection - KeyError: 'pattern_name'
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_address_detection - assert 0 == 1
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! KeyboardInterrupt !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
C:\Users\tomas\AppData\Local\Programs\Python\Python311\Lib\inspect.py:3004: KeyboardInterrupt
(to show a full traceback on KeyboardInterrupt use --full-trace)
================================ 16 failed, 240 passed, 1 warning in 413.63s (0:06:53) ================================
(venv) PS C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF> pytest
================================================= test session starts =================================================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0
rootdir: C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collected 275 items

tests\test_analytics_api.py .......................                                                              [  8%]
tests\test_analytics_engine.py ......                                                                            [ 10%]
tests\test_config_manager.py ...                                                                                 [ 11%]
tests\test_feedback_system.py ....                                                                               [ 13%]
tests\test_intelligent_cache.py .............................                                                    [ 23%]
tests\test_lithuanian_pii.py .FFFFFF.......                                                                      [ 28%]
tests\test_memory_optimizer.py ......................                                                            [ 36%]
tests\test_ml_integration_layer.py .........                                                                     [ 40%]
tests\test_pdf_processor.py FFFFFF                                                                               [ 42%]
tests\test_performance.py ........                                                                               [ 45%]
tests\test_performance_enhanced.py .......                                                                       [ 47%]
tests\test_performance_optimizer.py ......................F.                                                     [ 56%]
tests\test_pii_patterns.py ......                                                                                [ 58%]
tests\test_priority2_enhancements.py .........FFFF................                                               [ 69%]
tests\test_real_time_monitor.py .......                                                                          [ 71%]
tests\test_training_data_collector.py .........                                                                  [ 74%]
tests\test_validation_utils.py ........................                                                          [ 83%]
tests\adaptive\test_ab_testing.py ........                                                                       [ 86%]
tests\adaptive\test_doc_classifier.py ........                                                                   [ 89%]
tests\adaptive\test_online_learner.py ....                                                                       [ 90%]
tests\adaptive\test_pattern_db.py .....                                                                          [ 92%]
tests\adaptive\test_pattern_learner.py .......                                                                   [ 95%]
tests\adaptive\test_processing_rules.py ....                                                                     [ 96%]
tests\api\test_pdf_endpoint.py s.                                                                                [ 97%]
tests\system\test_adaptive_workflow.py .FFFsE                                                                    [ 99%]
tests\system\test_real_time_monitor_integration.py F                                                             [100%]

======================================================= ERRORS ========================================================
_____________________________ ERROR at setup of test_adaptive_workflow_learns_new_pattern _____________________________
ScopeMismatch: You tried to access the function scoped fixture db_session with a session scoped request object, involved factories:
tests\conftest.py:64:  def adaptive_coordinator(adaptive_pattern_db: app.core.adaptive.pattern_db.AdaptivePatternDB, ab_test_manager: app.core.adaptive.ab_testing.ABTestManager, config_manager: app.core.config_manager.ConfigManager) -> app.core.adaptive.coordinator.AdaptiveLearningCoordinator
tests\conftest.py:48:  def adaptive_pattern_db(db_session: sqlalchemy.orm.session.Session) -> Generator[app.core.adaptive.pattern_db.AdaptivePatternDB, NoneType, NoneType]
tests\conftest.py:20:  def db_session() -> Generator[sqlalchemy.orm.session.Session, NoneType, NoneType]
====================================================== FAILURES =======================================================
_____________________ TestLithuanianIntegration.test_comprehensive_lithuanian_document_processing _____________________
tests\test_lithuanian_pii.py:66: in test_comprehensive_lithuanian_document_processing
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 08:09:29,642 - config_manager - INFO - Loading default patterns because file was not found or failed to load.
2025-06-21 08:09:29,739 - config_manager - INFO - Patterns saved successfully - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmpxl8ekf4p\\test_config\\patterns.yaml"}
2025-06-21 08:09:29,740 - config_manager - INFO - Cities file not found, creating default - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmpxl8ekf4p\\test_config\\cities.yaml"}
2025-06-21 08:09:29,770 - config_manager - INFO - Cities saved successfully - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmpxl8ekf4p\\test_config\\cities.yaml", "cities_count": 81}
2025-06-21 08:09:29,784 - config_manager - INFO - Settings loaded from file - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmpxl8ekf4p\\test_config\\settings.yaml"}
2025-06-21 08:09:29,801 - config_manager - INFO - Brand names file not found, creating default - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmpxl8ekf4p\\test_config\\brand_names.yaml"}
2025-06-21 08:09:29,807 - config_manager - INFO - Saved brand names to file - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmpxl8ekf4p\\test_config\\brand_names.yaml"}
2025-06-21 08:09:29,814 - config_manager - INFO - Configuration manager initialized - {"config_dir": "C:\\Users\\tomas\\AppData\\Local\\Temp\\tmpxl8ekf4p\\test_config", "patterns_count": 38, "cities_count": 81}
2025-06-21 08:09:29,814 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 08:09:29,816 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 08:09:29,820 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 08:09:32,344 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 08:09:43,257 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:43,470 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
__________________________ TestLithuanianIntegration.test_simple_lithuanian_names_detection ___________________________
tests\test_lithuanian_pii.py:79: in test_simple_lithuanian_names_detection
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:47,165 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
_______________________ TestLithuanianIntegration.test_contextual_validation_of_technical_terms _______________________
tests\test_lithuanian_pii.py:87: in test_contextual_validation_of_technical_terms
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:47,387 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
_______________________ TestLithuanianIntegration.test_anti_overredaction_in_technical_context ________________________
tests\test_lithuanian_pii.py:94: in test_anti_overredaction_in_technical_context
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:47,672 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
__________________________ TestLithuanianIntegration.test_anti_overredaction_of_common_words __________________________
tests\test_lithuanian_pii.py:101: in test_anti_overredaction_of_common_words
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:47,899 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
_____________________________ TestLithuanianIntegration.test_redaction_report_generation ______________________________
tests\test_lithuanian_pii.py:118: in test_redaction_report_generation
    detections = test_pdf_processor.find_personal_info(text, language="lt")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:48,101 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
____________________________________ TestPDFProcessorUnit.test_find_personal_info _____________________________________
tests\test_pdf_processor.py:100: in test_find_personal_info
    detections = pdf_processor.find_personal_info(text, language="en")
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:50,987 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "en"}
__________________________ TestPDFProcessorUnit.test_deduplicate_with_confidence_simplified ___________________________
tests\test_pdf_processor.py:130: in test_deduplicate_with_confidence_simplified
    final_detections = pdf_processor.deduplicate_with_confidence({}, context_detections=context_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
_________________________________ TestPDFProcessorUnit.test_generate_redaction_report _________________________________
tests\test_pdf_processor.py:156: in test_generate_redaction_report
    assert report["categories"]["NAMES"] == 1
E   KeyError: 'NAMES'
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:51,381 - anonympdf.pdf - INFO - Redaction report generated - {"total_redactions": 2, "language": "en"}
________________________________ TestPDFProcessorIntegration.test_process_pdf_success _________________________________
tests\test_pdf_processor.py:181: in test_process_pdf_success
    assert result['status'] == 'processed'
E   AssertionError: assert 'error' == 'processed'
E     - processed
E     + error
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:54,669 - anonympdf.pdf - INFO - Language detected - {"language": "et", "sample_length": 26}
2025-06-21 08:09:54,669 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "et"}
2025-06-21 08:09:54,696 - anonympdf.pdf - ERROR - Error processing PDF - {"file": "C:\\Users\\tomas\\AppData\\Local\\Temp\\pytest-of-tomas\\pytest-241\\test_process_pdf_success0\\test.pdf", "error": "'DetectionContext' object has no attribute 'start'", "exc_info": true}
2025-06-21 08:09:54,706 - anonympdf.performance - INFO - File processing completed: pdf_processing - {"file_size_mb": 5.054473876953125e-05, "duration": 3.0399935245513916, "throughput": 1.6626594221772258e-05, "memory_delta": 98.36328125}
_______________________ TestPDFProcessorIntegration.test_process_pdf_failure_on_invalid_content _______________________
tests\test_pdf_processor.py:201: in test_process_pdf_failure_on_invalid_content
    assert result['status'] == 'failed'
E   AssertionError: assert 'error' == 'failed'
E     - failed
E     + error
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:09:54,935 - anonympdf.pdf - INFO - Language detected - {"language": "en", "sample_length": 9}
2025-06-21 08:09:54,935 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "en"}
2025-06-21 08:09:54,967 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.03205251693725586, "memory_delta": 0.0}
2025-06-21 08:09:54,973 - anonympdf.performance - INFO - File processing completed: pdf_processing - {"file_size_mb": 9.5367431640625e-06, "duration": 0.1795651912689209, "throughput": 5.311019968107325e-05, "memory_delta": -25.65234375}
_________________________________ TestPDFProcessorIntegration.test_anonymize_pdf_flow _________________________________
tests\test_pdf_processor.py:224: in test_anonymize_pdf_flow
    mock_extract.assert_called_once_with(input_pdf_path)
..\..\..\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:950: in assert_called_once_with
    raise AssertionError(msg)
E   AssertionError: Expected 'extract_text_from_pdf' to be called once. Called 0 times.
_______________________________ TestIntegration.test_performance_improvement_simulation _______________________________
tests\test_performance_optimizer.py:440: in test_performance_improvement_simulation
    assert par_duration < seq_duration
E   assert 4.990233898162842 < 4.817110776901245
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:10:03,101 - anonympdf.performance_optimizer - INFO - Starting optimized batch processing - {"task_count": 40}
2025-06-21 08:10:03,101 - anonympdf.performance_optimizer - INFO - Starting batch processing - {"batch_id": "batch_1750482603", "task_count": 40, "total_estimated_size": 251658240}
2025-06-21 08:10:03,214 - anonympdf.performance_optimizer - INFO - Batch processing configuration - {"batch_id": "batch_1750482603", "processing_mode": "sequential", "workers": 2, "avg_task_size_mb": 6.0}
2025-06-21 08:10:07,899 - anonympdf.performance_optimizer - INFO - Batch processing completed - {"batch_id": "batch_1750482603", "total_duration": 4.797904014587402, "tasks_processed": 40, "success_count": 40, "failure_count": 0, "avg_task_duration": 0.11994760036468506}
2025-06-21 08:10:07,917 - anonympdf.performance_optimizer - INFO - Optimized batch processing finished - {"duration": 4.816114187240601, "task_count": 40, "success_count": 40, "failure_count": 0}
2025-06-21 08:10:07,919 - anonympdf.performance_optimizer - INFO - Starting optimized batch processing - {"task_count": 40}
2025-06-21 08:10:07,919 - anonympdf.performance_optimizer - INFO - Starting batch processing - {"batch_id": "batch_1750482607", "task_count": 40, "total_estimated_size": 251658240}
2025-06-21 08:10:08,597 - anonympdf.performance_optimizer - INFO - Batch processing configuration - {"batch_id": "batch_1750482607", "processing_mode": "parallel_processes", "workers": 2, "avg_task_size_mb": 6.0}
2025-06-21 08:10:11,563 - config_manager - INFO - Patterns loaded and compiled from file - {"file": "config\\patterns.yaml", "patterns_count": 37}
2025-06-21 08:10:11,565 - config_manager - INFO - Patterns loaded and compiled from file - {"file": "config\\patterns.yaml", "patterns_count": 37}
2025-06-21 08:10:11,612 - config_manager - INFO - Cities loaded from file - {"file": "config\\cities.yaml", "cities_count": 79}
2025-06-21 08:10:11,613 - config_manager - INFO - Cities loaded from file - {"file": "config\\cities.yaml", "cities_count": 79}
2025-06-21 08:10:11,697 - config_manager - INFO - Settings loaded from file - {"file": "config\\settings.yaml"}
2025-06-21 08:10:11,743 - config_manager - INFO - Settings loaded from file - {"file": "config\\settings.yaml"}
2025-06-21 08:10:11,880 - config_manager - INFO - Brand names loaded from file - {"file": "config\\brand_names.yaml", "count": 0}
2025-06-21 08:10:11,880 - config_manager - INFO - Configuration manager initialized - {"config_dir": "config", "patterns_count": 37, "cities_count": 79}
2025-06-21 08:10:11,880 - anonympdf.intelligent_cache - INFO - IntelligentCache initialized - {"max_size": {"general": 1000, "patterns": 500, "models": 200}, "cleanup_interval": 300}
2025-06-21 08:10:11,887 - anonympdf.intelligent_cache - INFO - IntelligentCache singleton instance created.
2025-06-21 08:10:11,910 - config_manager - INFO - Brand names loaded from file - {"file": "config\\brand_names.yaml", "count": 0}
2025-06-21 08:10:11,917 - config_manager - INFO - Configuration manager initialized - {"config_dir": "config", "patterns_count": 37, "cities_count": 79}
2025-06-21 08:10:11,917 - anonympdf.intelligent_cache - INFO - IntelligentCache initialized - {"max_size": {"general": 1000, "patterns": 500, "models": 200}, "cleanup_interval": 300}
2025-06-21 08:10:11,917 - anonympdf.intelligent_cache - INFO - IntelligentCache singleton instance created.
2025-06-21 08:10:12,897 - anonympdf.performance_optimizer - INFO - Batch processing completed - {"batch_id": "batch_1750482607", "total_duration": 4.978339672088623, "tasks_processed": 40, "success_count": 40, "failure_count": 0, "avg_task_duration": 0.12445849180221558}
2025-06-21 08:10:12,908 - anonympdf.performance_optimizer - INFO - Optimized batch processing finished - {"duration": 4.988306045532227, "task_count": 40, "success_count": 40, "failure_count": 0}
_____________________________ TestAdvancedPatternRefinement.test_enhanced_email_detection _____________________________
tests\test_priority2_enhancements.py:134: in test_enhanced_email_detection
    email_detections = [d for d in detections if d['pattern_name'] == 'email_contextual']
tests\test_priority2_enhancements.py:134: in <listcomp>
    email_detections = [d for d in detections if d['pattern_name'] == 'email_contextual']
E   KeyError: 'pattern_name'
_____________________________ TestAdvancedPatternRefinement.test_enhanced_phone_detection _____________________________
tests\test_priority2_enhancements.py:145: in test_enhanced_phone_detection
    assert len(phone_detections) == 1
E   assert 0 == 1
E    +  where 0 = len([])
_________________________ TestAdvancedPatternRefinement.test_enhanced_personal_code_detection _________________________
tests\test_priority2_enhancements.py:154: in test_enhanced_personal_code_detection
    code_detections = [d for d in detections if d['pattern_name'] == 'lithuanian_personal_code_contextual']
tests\test_priority2_enhancements.py:154: in <listcomp>
    code_detections = [d for d in detections if d['pattern_name'] == 'lithuanian_personal_code_contextual']
E   KeyError: 'pattern_name'
____________________________ TestAdvancedPatternRefinement.test_enhanced_address_detection ____________________________
tests\test_priority2_enhancements.py:165: in test_enhanced_address_detection
    assert len(address_detections) == 1
E   assert 0 == 1
E    +  where 0 = len([])
_____________________ test_feedback_learns_and_discovers_new_pattern[EMP-ID-98765-EMPLOYEE_ID-en] _____________________
tests\system\test_adaptive_workflow.py:67: in test_feedback_learns_and_discovers_new_pattern
    initial_detections = pdf_processor.find_personal_info(test_text, language=language)
app\core\performance.py:350: in wrapper
    return func(*args, **kwargs)
app\services\pdf_processor.py:314: in find_personal_info
    return self.deduplicate_with_confidence(personal_info, context_aware_detections)
app\services\pdf_processor.py:359: in deduplicate_with_confidence
    detection_range = set(range(detection.start, detection.end))
E   AttributeError: 'DetectionContext' object has no attribute 'start'
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 08:15:56,094 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 08:15:56,096 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 08:16:13,598 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 08:16:13,600 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 08:16:13,600 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95, 'min_samples': 10}
2025-06-21 08:16:13,662 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 08:16:13,663 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 08:16:13,664 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 08:16:13,709 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 08:16:13,710 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 08:16:39,671 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 08:16:39,681 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 08:16:39,683 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95, 'min_samples': 10}
2025-06-21 08:16:39,685 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 08:16:39,686 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 08:16:39,688 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 37, "cities_count": 79}
2025-06-21 08:16:39,688 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 08:16:42,029 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 08:16:45,733 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:16:45,776 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "en"}
__________________ test_feedback_learns_and_discovers_new_pattern[PROJ-SECRET-ALPHA-PROJECT_CODE-en] __________________
tests\system\test_adaptive_workflow.py:97: in test_feedback_learns_and_discovers_new_pattern
    assert any(p.pii_category == corrected_category for p in active_patterns), \
E   AssertionError: Adaptive pattern was not found in the active patterns after learning.
E   assert False
E    +  where False = any(<generator object test_feedback_learns_and_discovers_new_pattern.<locals>.<genexpr> at 0x00000206121E9D20>)
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 08:16:46,246 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 08:16:46,247 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 08:17:12,644 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 08:17:12,646 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 08:17:12,646 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95, 'min_samples': 10}
2025-06-21 08:17:12,763 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 08:17:12,763 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 08:17:12,763 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 08:17:12,812 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 08:17:12,812 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 08:17:46,713 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 08:17:46,714 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 08:17:46,716 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95, 'min_samples': 10}
2025-06-21 08:17:46,716 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 08:17:46,716 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 08:17:46,716 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 37, "cities_count": 79}
2025-06-21 08:17:46,716 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 08:17:49,162 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 08:17:52,187 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:17:52,200 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "en"}
2025-06-21 08:17:52,364 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.16617918014526367, "memory_delta": 2.25390625}
2025-06-21 08:17:52,369 - anonympdf.adaptive_learning.coordinator - INFO - Starting pattern discovery for 1 new PII instances.
2025-06-21 08:17:52,371 - anonympdf.adaptive_learning.coordinator - INFO - No new patterns were discovered.
2025-06-21 08:17:52,401 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
_________________ test_feedback_learns_and_discovers_new_pattern[MIN-KORT-98765-LT_MINISTRY_CARD-lt] __________________
tests\system\test_adaptive_workflow.py:97: in test_feedback_learns_and_discovers_new_pattern
    assert any(p.pii_category == corrected_category for p in active_patterns), \
E   AssertionError: Adaptive pattern was not found in the active patterns after learning.
E   assert False
E    +  where False = any(<generator object test_feedback_learns_and_discovers_new_pattern.<locals>.<genexpr> at 0x000002065BC4E960>)
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 08:17:52,535 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 08:17:52,535 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 08:18:11,577 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 08:18:11,578 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 08:18:11,579 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95, 'min_samples': 10}
2025-06-21 08:18:11,676 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 08:18:11,676 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 08:18:11,676 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 08:18:11,747 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 08:18:11,748 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 08:18:26,693 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 08:18:26,693 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 08:18:26,693 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95, 'min_samples': 10}
2025-06-21 08:18:26,693 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 08:18:26,693 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 08:18:26,693 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 37, "cities_count": 79}
2025-06-21 08:18:26,709 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 08:18:28,493 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 08:18:30,484 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:18:30,488 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
2025-06-21 08:18:30,520 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.031565189361572266, "memory_delta": 0.29296875}
2025-06-21 08:18:30,521 - anonympdf.adaptive_learning.coordinator - INFO - Starting pattern discovery for 1 new PII instances.
2025-06-21 08:18:30,522 - anonympdf.adaptive_learning.coordinator - INFO - No new patterns were discovered.
2025-06-21 08:18:30,523 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
_____________________________________________ test_monitoring_end_to_end ______________________________________________
tests\system\test_real_time_monitor_integration.py:55: in test_monitoring_end_to_end
    assert len(logged_metrics) > 0, "No metrics were logged to the real-time monitor database."
E   AssertionError: No metrics were logged to the real-time monitor database.
E   assert 0 > 0
E    +  where 0 = len([])
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 08:18:30,642 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 08:18:30,650 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 08:18:30,652 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 08:18:32,371 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 08:18:33,843 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
2025-06-21 08:18:33,958 - anonympdf.pdf - ERROR - Error processing PDF - {"file": "tests\\samples\\simple_pii_document.txt", "error": "Logger._log() got an unexpected keyword argument 'error'", "exc_info": true}
2025-06-21 08:18:33,959 - anonympdf.performance - INFO - File processing completed: pdf_processing - {"file_size_mb": 0.0002422332763671875, "duration": 0.09900736808776855, "throughput": 0.00244661868147481, "memory_delta": -5.51953125}
-------------------------------------------------- Captured log call --------------------------------------------------
INFO     app.core.text_extraction:text_extraction.py:50 Starting robust text extraction
================================================== warnings summary ===================================================
tests/adaptive/test_ab_testing.py::TestABTestManager::test_record_and_evaluate_metrics_variant_wins
  C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF\venv\Lib\site-packages\scipy\stats\_axis_nan_policy.py:586: RuntimeWarning: Precision loss occurred in moment calculation due to catastrophic cancellation. This occurs when the data are nearly identical. Results may be unreliable.
    res = hypotest_fun_out(*samples, **kwds)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.11.9-final-0 -----------
Name                                    Stmts   Miss  Cover   Missing
---------------------------------------------------------------------
app\__init__.py                             0      0   100%
app\api\__init__.py                         0      0   100%
app\api\endpoints\__init__.py               0      0   100%
app\api\endpoints\analytics.py            258     59    77%   32-35, 40-43, 48-51, 56-59, 192-194, 230-232, 250-252, 286-288, 304-306, 357-359, 389-391, 420-423, 446-448, 458-460, 467, 500-503, 561-566, 597, 600-603
app\api\endpoints\feedback.py              48     26    46%   41-92
app\api\endpoints\monitoring.py            10      2    80%   14, 21
app\api\endpoints\pdf.py                  101     62    39%   27, 50-100, 106-107, 113-124, 130-163, 171, 176-182, 188-201
app\core\__init__.py                        0      0   100%
app\core\adaptive\__init__.py               0      0   100%
app\core\adaptive\ab_testing.py           145     10    93%   92-94, 182, 219-220, 256, 329-331
app\core\adaptive\coordinator.py          125     48    62%   25-32, 56-64, 127, 172-173, 183-187, 212-219, 226, 230-231, 235-236, 247-266, 270-273
app\core\adaptive\doc_classifier.py        44      1    98%   84
app\core\adaptive\online_learner.py        31      5    84%   45-46, 66-68
app\core\adaptive\pattern_db.py           125     39    69%   47-51, 83-90, 119-121, 125-127, 144-145, 201-204, 220-221, 242-247, 251, 258-264
app\core\adaptive\pattern_learner.py       64      6    91%   20, 56, 96-101, 123
app\core\adaptive\processing_rules.py      54      7    87%   82-89, 94
app\core\analytics_engine.py              214     46    79%   102-104, 195-196, 222-227, 231-256, 260-275, 288-289, 318-320, 340-353, 398-401, 405, 409-411, 416
app\core\config_manager.py                262    125    52%   60-61, 78-79, 132-138, 155-156, 162-163, 263-267, 379, 441-443, 465-467, 476-478, 482-493, 497-512, 516-540, 544-584, 588-663, 667
app\core\context_analyzer.py              216     24    89%   56, 71, 76-78, 84, 198-204, 331-332, 445, 452, 455, 486, 488, 533, 569-579
app\core\data_models.py                    45      9    80%   47-51, 56-59
app\core\dependencies.py                  150     76    49%   29-31, 58-60, 88-90, 113-114, 116, 123, 129-151, 155-187, 201-207, 216-231, 238-243, 254-263, 269-280
app\core\feature_engineering.py           332     80    76%   21, 70, 75, 100, 131, 138-143, 159, 200, 238-239, 243-256, 278-279, 287, 314-315, 333, 340-341, 359, 393-399, 419, 482, 496, 511-521, 527, 534-536, 540, 546, 562-576, 652-653, 657-660, 695-715, 720-729
app\core\feedback_system.py               272    103    62%   27-28, 101-115, 131-166, 178-221, 254-258, 271-272, 281-282, 287, 290, 305, 349-358, 361, 398-400, 407-409, 414, 422-427, 433-436, 469-473, 481, 511-513, 538-556, 560-567
app\core\intelligent_cache.py             373     31    92%   114-115, 135-141, 333-340, 359-360, 396, 413, 443, 445, 460-461, 490, 525-526, 546, 582-583, 596-600, 625-626, 670, 708
app\core\lithuanian_enhancements.py       124     16    87%   277, 323, 341-342, 360-361, 364-365, 368-369, 394-395, 465, 503-505
app\core\logging.py                       110     26    76%   44-55, 59-71, 87, 98, 104, 106, 196-216
app\core\memory_optimizer.py              297     52    82%   91-97, 102, 144, 241-242, 297, 329, 342-343, 351-356, 373-375, 421, 445, 460-476, 484-485, 525-563, 571-573, 585-586, 606-607
app\core\memory_utils.py                   23      9    61%   15, 20, 25, 30, 42-44, 49-50
app\core\ml_engine.py                     244    153    37%   33, 53-74, 83, 86, 89-90, 96-98, 102-130, 175-179, 183-209, 217, 221, 234-238, 265-322, 331-339, 345-356, 360-374, 386-451, 456-472, 476-481, 499-523
app\core\ml_integration.py                202     85    58%   20, 60, 75, 114-117, 166-168, 176-177, 181-183, 190-233, 239-261, 265-269, 277, 296, 308-352, 404-426, 430-446, 458-460, 464-466, 470-471, 477
app\core\ml_monitoring.py                 280    166    41%   39-56, 73, 114-124, 128-179, 248-251, 255-289, 293-313, 317-334, 338-386, 453-466, 470-475, 479-502, 506-507, 525-548, 552-567, 571-580, 586, 590, 594-618, 622, 626, 630-631, 635-637, 641-645, 651
app\core\ml_training_pipeline.py          147     82    44%   65-67, 82, 89-93, 107-132, 136, 140-145, 152, 166-198, 208-213, 227-244, 251-254, 258-275, 280
app\core\nlp_loader.py                     19     19     0%   1-36
app\core\performance.py                   191     19    90%   93, 153, 188, 220, 271-279, 314, 329-330, 336-340, 365, 369
app\core\performance_optimizer.py         393     99    75%   98-106, 118, 122-123, 172, 176-177, 213, 235, 256-319, 336, 389-395, 416-417, 450-451, 486-489, 570-571, 588-589, 610-616, 632-633, 686, 708-719, 728-766, 807-837, 841-843, 847-863, 877
app\core\real_time_monitor.py             310    174    44%   72, 108-110, 145-147, 166-168, 224-225, 239-251, 293-326, 330-336, 340-345, 349-381, 393-453, 457-525, 529-530, 534-538, 542-549, 553-556, 560-563, 571-582, 586-600, 604-641, 645-650, 654-655, 659-660
app\core\salutation_detector.py           143    113    21%   38-40, 44, 89, 100, 117-140, 144-185, 195-231, 236-252, 256-267, 272-304, 308-333, 341-354, 361-390
app\core\text_extraction.py               120     50    58%   80-82, 89-106, 125-127, 131-166, 170-175, 227-258, 263-282, 291, 301, 308
app\core\training_data.py                 305    139    54%   43, 68-70, 82, 103-104, 109, 130-131, 138, 174-175, 182, 224-226, 254-271, 275-280, 292-333, 345-383, 432-452, 456-508, 513-530, 534-568, 572-620, 658-665, 704, 745-778, 784
app\core\validation_utils.py              188     38    80%   123-127, 137, 170-171, 186, 202, 208-213, 219-225, 241-250, 270, 275-280, 303-307, 311-315, 360-361, 366-367, 377-378, 490-499
app\database.py                            12      0   100%
app\db\migrations.py                      100     46    54%   26, 48-112, 130-131, 136-138, 160-165, 169-185, 196-197
app\dependencies.py                        25      8    68%   20, 26, 35-36, 41-45
app\main.py                                82     41    50%   26-27, 31-33, 39-50, 81-84, 90-91, 97, 102, 107, 120-153
app\models\pdf_document.py                 21      0   100%
app\pdf_processor.py                       19     13    32%   19-33
app\schemas\pdf.py                         18      0   100%
app\services\__init__.py                    0      0   100%
app\services\pdf_processor.py             291    140    52%   77, 102-164, 185-187, 203, 292-293, 321-339, 360-377, 387-396, 405-438, 444-448, 456-528, 544, 549-550, 564, 574, 598-600, 616, 627-631, 645-653, 665-669
app\version.py                              1      0   100%
app\worker.py                              58     38    34%   45-55, 63-115
---------------------------------------------------------------------
TOTAL                                    6592   2285    65%

FAIL Required test coverage of 80% not reached. Total coverage: 65.34%
================================================ slowest 10 durations =================================================
66.03s setup    tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[PROJ-SECRET-ALPHA-PROJECT_CODE-en]
49.70s setup    tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[EMP-ID-98765-EMPLOYEE_ID-en]
46.44s setup    tests/system/test_adaptive_workflow.py::test_fixture_creation
43.03s setup    tests/test_training_data_collector.py::TestTrainingDataCollector::test_get_balanced_training_set_empty
37.98s setup    tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[MIN-KORT-98765-LT_MINISTRY_CARD-lt]
32.63s setup    tests/adaptive/test_pattern_learner.py::TestDiscoverAndValidatePatterns::test_recall_threshold
32.33s setup    tests/adaptive/test_pattern_learner.py::TestDiscoverAndValidatePatterns::test_low_precision_filtered
25.51s call     tests/test_feedback_system.py::TestFeedbackSystemIntegration::test_feedback_submission_flow_is_deterministic
24.16s setup    tests/test_training_data_collector.py::TestTrainingDataCollector::test_get_balanced_training_set_with_data
23.41s setup    tests/adaptive/test_pattern_learner.py::TestValidateRegex::test_false_negative
=============================================== short test summary info ===============================================
SKIPPED [1] tests\api\test_pdf_endpoint.py:26: Test PDF not found at C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF\tests\samples\lithuanian_pii_document.pdf
SKIPPED [1] tests\system\test_adaptive_workflow.py:117: Skipping API test until '/api/v1/pdf/process' is implemented.
ERROR tests/system/test_adaptive_workflow.py::test_adaptive_workflow_learns_new_pattern - Failed: ScopeMismatch: You tried to access the function scoped fixture db_session with a session scoped request obj...
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_comprehensive_lithuanian_document_processing - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_simple_lithuanian_names_detection - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_contextual_validation_of_technical_terms - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_anti_overredaction_in_technical_context - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_anti_overredaction_of_common_words - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_redaction_report_generation - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_pdf_processor.py::TestPDFProcessorUnit::test_find_personal_info - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_pdf_processor.py::TestPDFProcessorUnit::test_deduplicate_with_confidence_simplified - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/test_pdf_processor.py::TestPDFProcessorUnit::test_generate_redaction_report - KeyError: 'NAMES'
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_process_pdf_success - AssertionError: assert 'error' == 'processed'
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_process_pdf_failure_on_invalid_content - AssertionError: assert 'error' == 'failed'
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_anonymize_pdf_flow - AssertionError: Expected 'extract_text_from_pdf' to be called once. Called 0 times.
FAILED tests/test_performance_optimizer.py::TestIntegration::test_performance_improvement_simulation - assert 4.990233898162842 < 4.817110776901245
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_email_detection - KeyError: 'pattern_name'
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_phone_detection - assert 0 == 1
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_personal_code_detection - KeyError: 'pattern_name'
FAILED tests/test_priority2_enhancements.py::TestAdvancedPatternRefinement::test_enhanced_address_detection - assert 0 == 1
FAILED tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[EMP-ID-98765-EMPLOYEE_ID-en] - AttributeError: 'DetectionContext' object has no attribute 'start'
FAILED tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[PROJ-SECRET-ALPHA-PROJECT_CODE-en] - AssertionError: Adaptive pattern was not found in the active patterns after learning.
FAILED tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[MIN-KORT-98765-LT_MINISTRY_CARD-lt] - AssertionError: Adaptive pattern was not found in the active patterns after learning.
FAILED tests/system/test_real_time_monitor_integration.py::test_monitoring_end_to_end - AssertionError: No metrics were logged to the real-time monitor database.
====================== 21 failed, 251 passed, 2 skipped, 1 warning, 1 error in 601.85s (0:10:01) ======================
(venv) PS C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF>