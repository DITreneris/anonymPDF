================================================ test session starts =================================================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0
rootdir: C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0
asyncio: mode=Mode.STRICT
collected 273 items

tests\test_analytics_api.py .......................                                                              [  8%]
tests\test_analytics_engine.py ......                                                                            [ 10%]
tests\test_config_manager.py ...                                                                                 [ 11%]
tests\test_feedback_system.py ....                                                                               [ 13%]
tests\test_intelligent_cache.py .............................                                                    [ 23%]
tests\test_lithuanian_pii.py ..F.FFF.......                                                                      [ 28%]
tests\test_memory_optimizer.py ......................                                                            [ 36%]
tests\test_ml_integration_layer.py .........                                                                     [ 40%]
tests\test_pdf_processor.py EEEF.F                                                                               [ 42%]
tests\test_performance.py ........                                                                               [ 45%]
tests\test_performance_enhanced.py .......                                                                       [ 47%]
tests\test_performance_optimizer.py ........................                                                     [ 56%]
tests\test_pii_patterns.py ......                                                                                [ 58%]
tests\test_priority2_enhancements.py ...........................                                                 [ 68%]
tests\test_real_time_monitor.py .......                                                                          [ 71%]
tests\test_training_data_collector.py .........                                                                  [ 74%]
tests\test_validation_utils.py ........................                                                          [ 83%]
tests\adaptive\test_ab_testing.py ........                                                                       [ 86%]
tests\adaptive\test_doc_classifier.py ........                                                                   [ 89%]
tests\adaptive\test_online_learner.py ....                                                                       [ 90%]
tests\adaptive\test_pattern_db.py .....                                                                          [ 92%]
tests\adaptive\test_pattern_learner.py ....FF.                                                                   [ 95%]
tests\adaptive\test_processing_rules.py ....                                                                     [ 96%]
tests\api\test_pdf_endpoint.py s.                                                                                [ 97%]
tests\system\test_adaptive_workflow.py ....s.                                                                    [ 99%]
tests\system\test_real_time_monitor_integration.py F                                                             [100%]

======================================================= ERRORS ========================================================
___________________________ ERROR at setup of TestPDFProcessorUnit.test_find_personal_info ____________________________
tests\test_pdf_processor.py:24: in mock_config_manager
    cm.get_patterns.return_value = cm.patterns
..\..\..\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:653: in __getattr__
    raise AttributeError("Mock object has no attribute %r" % name)
E   AttributeError: Mock object has no attribute 'get_patterns'
_________________ ERROR at setup of TestPDFProcessorUnit.test_deduplicate_with_confidence_simplified __________________
tests\test_pdf_processor.py:24: in mock_config_manager
    cm.get_patterns.return_value = cm.patterns
..\..\..\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:653: in __getattr__
    raise AttributeError("Mock object has no attribute %r" % name)
E   AttributeError: Mock object has no attribute 'get_patterns'
________________________ ERROR at setup of TestPDFProcessorUnit.test_generate_redaction_report ________________________
tests\test_pdf_processor.py:24: in mock_config_manager
    cm.get_patterns.return_value = cm.patterns
..\..\..\AppData\Local\Programs\Python\Python311\Lib\unittest\mock.py:653: in __getattr__
    raise AttributeError("Mock object has no attribute %r" % name)
E   AttributeError: Mock object has no attribute 'get_patterns'
====================================================== FAILURES =======================================================
__________________________ TestLithuanianIntegration.test_simple_lithuanian_names_detection ___________________________
tests\test_lithuanian_pii.py:81: in test_simple_lithuanian_names_detection
    assert "Linas Vaitkus" in detected_names
E   AssertionError: assert 'Linas Vaitkus' in set()
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:37:39,253 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 11:37:39,253 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 11:37:39,268 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:37:39,268 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:37:39,268 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 11:37:39,284 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:37:39,284 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:37:44,063 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:37:44,063 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:37:44,063 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95}
2025-06-21 11:37:44,063 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 11:37:44,063 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 11:37:44,063 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 11:37:44,063 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 11:37:45,003 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 11:37:45,814 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:37:45,814 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
2025-06-21 11:37:45,814 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
2025-06-21 11:37:45,830 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.01562190055847168, "memory_delta": 0.05078125}
_______________________ TestLithuanianIntegration.test_anti_overredaction_in_technical_context ________________________
tests\test_lithuanian_pii.py:96: in test_anti_overredaction_in_technical_context
    assert "Vilniaus" in detected_locations
E   AssertionError: assert 'Vilniaus' in set()
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:37:52,929 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 11:37:52,930 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 11:37:52,945 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:37:52,945 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:37:52,945 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 11:37:52,955 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:37:52,955 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:37:57,953 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:37:57,953 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:37:57,953 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95}
2025-06-21 11:37:57,953 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 11:37:57,953 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 11:37:57,953 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 11:37:57,969 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 11:37:58,635 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 11:37:59,469 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:37:59,469 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
2025-06-21 11:37:59,469 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
2025-06-21 11:37:59,485 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.015655994415283203, "memory_delta": 0.0625}
__________________________ TestLithuanianIntegration.test_anti_overredaction_of_common_words __________________________
tests\test_lithuanian_pii.py:104: in test_anti_overredaction_of_common_words
    assert "summary" in report
E   AssertionError: assert 'summary' in {'categories': {'TIME': 1, 'lithuanian_names': 1}, 'details': {'TIME': [('99999', 'CONTEXT_0.50')], 'lithuanian_names': [('Jonas', 'CONTEXT_0.60')]}, 'language': 'lt', 'total_redactions': 2}
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:37:59,501 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 11:37:59,501 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 11:37:59,516 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:37:59,516 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:37:59,516 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 11:37:59,537 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:37:59,537 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:38:05,401 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:38:05,401 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:38:05,401 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95}
2025-06-21 11:38:05,402 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 11:38:05,402 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 11:38:05,403 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 11:38:05,404 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 11:38:06,451 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 11:38:07,544 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:38:07,559 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
2025-06-21 11:38:07,559 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
2025-06-21 11:38:07,566 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.006541013717651367, "memory_delta": 0.0546875}
2025-06-21 11:38:07,566 - anonympdf.pdf - INFO - Redaction report generated - {"total_redactions": 2, "language": "lt"}
_____________________________ TestLithuanianIntegration.test_redaction_report_generation ______________________________
tests\test_lithuanian_pii.py:121: in test_redaction_report_generation
    assert "summary" in report
E   AssertionError: assert 'summary' in {'categories': {'TIME': 1, 'lithuanian_names': 1}, 'details': {'TIME': [('99999', 'CONTEXT_0.50')], 'lithuanian_names': [('Jonas', 'CONTEXT_0.60')]}, 'language': 'lt', 'total_redactions': 2}
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:38:07,582 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 11:38:07,582 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 11:38:07,613 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:38:07,613 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:38:07,613 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 11:38:07,628 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:38:07,628 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:38:12,646 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:38:12,646 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:38:12,646 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95}
2025-06-21 11:38:12,646 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 11:38:12,646 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 11:38:12,646 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 11:38:12,646 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 11:38:13,415 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 11:38:14,697 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:38:14,705 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
2025-06-21 11:38:14,705 - anonympdf.pdf - INFO - Using Lithuanian NLP model for processing
2025-06-21 11:38:14,717 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.020123004913330078, "memory_delta": 0.0546875}
2025-06-21 11:38:14,717 - anonympdf.pdf - INFO - Redaction report generated - {"total_redactions": 2, "language": "lt"}
________________________________ TestPDFProcessorIntegration.test_process_pdf_success _________________________________
tests\test_pdf_processor.py:139: in test_process_pdf_success
    assert categories.get('lithuanian_personal_codes') == 1
E   AssertionError: assert None == 1
E    +  where None = <built-in method get of dict object at 0x000002304E0BBD80>('lithuanian_personal_codes')
E    +    where <built-in method get of dict object at 0x000002304E0BBD80> = {'DATE': 1, 'PERSON': 1, 'emails': 1}.get
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:38:17,048 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 11:38:17,048 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 11:38:17,063 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:38:17,063 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:38:17,063 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 11:38:17,079 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:38:17,079 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:38:22,637 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:38:22,653 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:38:22,653 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95}
2025-06-21 11:38:22,653 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 11:38:22,653 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 11:38:22,653 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 11:38:22,653 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 11:38:24,734 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 11:38:26,692 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:38:26,892 - anonympdf.performance - INFO - Performance tracking: text_extraction - {"duration": 0.11586141586303711, "memory_delta": 0.71484375}
2025-06-21 11:38:27,631 - anonympdf.pdf - INFO - Language detected - {"language": "pt", "sample_length": 46}
2025-06-21 11:38:27,631 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
2025-06-21 11:38:27,631 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "pt"}
2025-06-21 11:38:27,647 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.015665769577026367, "memory_delta": 0.0078125}
2025-06-21 11:38:27,662 - anonympdf.pdf - INFO - PDF anonymized successfully - {"input_file": "test.pdf", "output_file": "test_redacted_20250621_113826.pdf", "redactions_applied": 3}
2025-06-21 11:38:27,662 - anonympdf.pdf - INFO - Redaction report generated - {"total_redactions": 3, "language": "pt"}
2025-06-21 11:38:27,678 - anonympdf.performance - INFO - File processing completed: pdf_processing - {"file_size_mb": 0.000774383544921875, "duration": 0.8861367702484131, "throughput": 0.0008738871593205527, "memory_delta": 36.8359375}
_________________________________ TestPDFProcessorIntegration.test_anonymize_pdf_flow _________________________________
tests\test_pdf_processor.py:181: in test_anonymize_pdf_flow
    assert len(list(page.annots(types=[fitz.PDF_ANNOT_SQUARE]))) > 0, "No redaction annotations found."
E   AssertionError: No redaction annotations found.
E   assert 0 > 0
E    +  where 0 = len([])
E    +    where [] = list(<generator object Page.annots at 0x0000023070DF5F40>)
E    +      where <generator object Page.annots at 0x0000023070DF5F40> = <bound method Page.annots of page 0 of C:\Users\tomas\AppData\Local\Temp\pytest-of-tomas\pytest-267\test_anonymize_pdf_flow0\anonymized_output.pdf>(types=[4])
E    +        where <bound method Page.annots of page 0 of C:\Users\tomas\AppData\Local\Temp\pytest-of-tomas\pytest-267\test_anonymize_pdf_flow0\anonymized_output.pdf> = page 0 of C:\Users\tomas\AppData\Local\Temp\pytest-of-tomas\pytest-267\test_anonymize_pdf_flow0\anonymized_output.pdf.annots
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:38:34,841 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 11:38:34,841 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 11:38:34,861 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:38:34,861 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:38:34,861 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 11:38:34,881 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:38:34,881 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:38:42,692 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:38:42,692 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:38:42,692 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95}
2025-06-21 11:38:42,692 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 11:38:42,692 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 11:38:42,692 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 11:38:42,694 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 11:38:43,728 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 11:38:44,802 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:38:44,856 - anonympdf.performance - INFO - Performance tracking: text_extraction - {"duration": 0.046871185302734375, "memory_delta": 0.0390625}
2025-06-21 11:38:44,871 - anonympdf.pdf - INFO - Language detected - {"language": "en", "sample_length": 65}
2025-06-21 11:38:44,871 - anonympdf.adaptive_pattern_db - INFO - Retrieved 0 active patterns from the database.
2025-06-21 11:38:44,871 - anonympdf.pdf - INFO - Using English NLP model for processing - {"language": "en"}
2025-06-21 11:38:44,887 - anonympdf.performance - INFO - Performance tracking: pii_detection - {"duration": 0.01562190055847168, "memory_delta": 0.01171875}
2025-06-21 11:38:44,909 - anonympdf.pdf - INFO - PDF anonymized successfully - {"input_file": "simple_pii_document.pdf", "output_file": "anonymized_output.pdf", "redactions_applied": 2}
2025-06-21 11:38:44,909 - anonympdf.pdf - INFO - Redaction report generated - {"total_redactions": 2, "language": "en"}
_____________________________ TestDiscoverAndValidatePatterns.test_low_precision_filtered _____________________________
tests\adaptive\test_pattern_learner.py:92: in test_low_precision_filtered
    assert patterns == []
E   AssertionError: assert [AdaptivePatt... 46, 795019))] == []
E     Left contains one more item: AdaptivePattern(pattern_id='p_3394787663614706834', regex='\\bABC\\-123\\b', pii_category='CODE', confidence=1.0, posi...tetime.datetime(2025, 6, 21, 11, 39, 46, 795019), last_validated_at=datetime.datetime(2025, 6, 21, 11, 39, 46, 795019))
E     Use -v to get more diff
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:39:46,793 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:39:46,793 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:39:46,794 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.8}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:39:46,795 - anonympdf.anonympdf.pattern_learner - INFO - Discovered and validated new pattern: \bABC\-123\b - {'precision': '1.00', 'recall': '1.00'}
______________________________ TestDiscoverAndValidatePatterns.test_insufficient_samples ______________________________
tests\adaptive\test_pattern_learner.py:101: in test_insufficient_samples
    assert patterns == []
E   AssertionError: assert [AdaptivePatt... 51, 849630))] == []
E     Left contains one more item: AdaptivePattern(pattern_id='p_8923428024601118513', regex='\\b999\\-0000\\b', pii_category='PHONE', confidence=1.0, po...tetime.datetime(2025, 6, 21, 11, 39, 51, 849630), last_validated_at=datetime.datetime(2025, 6, 21, 11, 39, 51, 849630))
E     Use -v to get more diff
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:39:51,846 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:39:51,846 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:39:51,847 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.8}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:39:51,849 - anonympdf.anonympdf.pattern_learner - INFO - Discovered and validated new pattern: \b999\-0000\b - {'precision': '1.00', 'recall': '1.00'}
_____________________________________________ test_monitoring_end_to_end ______________________________________________
tests\system\test_real_time_monitor_integration.py:57: in test_monitoring_end_to_end
    assert len(logged_metrics) > 0, "No metrics were logged to the real-time monitor database."
E   AssertionError: No metrics were logged to the real-time monitor database.
E   assert 0 > 0
E    +  where 0 = len([])
------------------------------------------------ Captured stderr setup ------------------------------------------------
2025-06-21 11:40:50,360 - anonympdf.adaptive_pattern_db - INFO - Table 'adaptive_patterns' is ready.
2025-06-21 11:40:50,360 - anonympdf.adaptive_pattern_db - INFO - AdaptivePatternDB initialized (manages session: False).
2025-06-21 11:40:50,376 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:40:50,376 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:40:50,377 - anonympdf.adaptive_learning.doc_classifier - INFO - DocumentClassifier initialized.
2025-06-21 11:40:50,392 - anonympdf.adaptive_learning.processing_rules - INFO - Successfully loaded 4 rule sets from config\processing_rules.yaml
2025-06-21 11:40:50,392 - anonympdf.adaptive_learning.processing_rules - INFO - ProcessingRuleManager initialized with 4 rule sets.
2025-06-21 11:40:55,963 - anonympdf.anonympdf.feedback_system - INFO - FeedbackAnalyzer initialized
2025-06-21 11:40:55,963 - anonympdf.anonympdf.feedback_system - INFO - UserFeedbackProcessor initialized
2025-06-21 11:40:55,964 - anonympdf.anonympdf.pattern_learner - INFO - PatternLearner initialized - {'min_confidence': 0.95}
2025-06-21 11:40:55,964 - anonympdf.adaptive_learning.coordinator - INFO - AdaptiveLearningCoordinator initialized.
2025-06-21 11:40:55,964 - anonympdf.pdf - INFO - Initializing PDF processor with Priority 2 enhancements
2025-06-21 11:40:55,964 - anonympdf.pdf - INFO - Configuration manager loaded - {"patterns_count": 38, "cities_count": 81}
2025-06-21 11:40:55,965 - anonympdf.pdf - INFO - Priority 2 context-aware components initialized
2025-06-21 11:40:56,657 - anonympdf.pdf - INFO - English spaCy model loaded successfully - {"model": "en_core_web_sm", "components": 6, "method": "standard"}
2025-06-21 11:40:57,484 - anonympdf.pdf - INFO - Lithuanian spaCy model loaded successfully - {"model": "lt_core_news_sm", "components": 7, "method": "standard"}
------------------------------------------------ Captured stderr call -------------------------------------------------
2025-06-21 11:40:57,511 - anonympdf.pdf - ERROR - Failed to anonymize PDF - {"file": "simple_pii_document.txt", "error": "Logger._log() got an unexpected keyword argument 'error'", "exc_info": true}
2025-06-21 11:40:57,514 - anonympdf.performance - INFO - File processing completed: pdf_processing - {"file_size_mb": 0.0002422332763671875, "duration": 0.025768756866455078, "throughput": 0.009400270165244907, "memory_delta": -0.56640625}
-------------------------------------------------- Captured log call --------------------------------------------------
INFO     app.core.text_extraction:text_extraction.py:50 Starting robust text extraction
---------------------------------------------- Captured stderr teardown -----------------------------------------------
2025-06-21 11:40:57,525 - anonympdf.ab_testing - INFO - Database connection to C:\Users\tomas\AppData\Local\Temp\pytest-of-tomas\pytest-267\ab_test_data0\ab_tests.db closed.
================================================== warnings summary ===================================================
tests/adaptive/test_ab_testing.py::TestABTestManager::test_record_and_evaluate_metrics_variant_wins
  C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF\venv\Lib\site-packages\scipy\stats\_axis_nan_policy.py:586: RuntimeWarning: Precision loss occurred in moment calculation due to catastrophic cancellation. This occurs when the data are nearly identical. Results may be unreliable.
    res = hypotest_fun_out(*samples, **kwds)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.11.9-final-0 -----------
Name                                    Stmts   Miss  Cover   Missing
---------------------------------------------------------------------
app\__init__.py                             0      0   100%
app\api\__init__.py                         0      0   100%
app\api\endpoints\__init__.py               0      0   100%
app\api\endpoints\analytics.py            258     59    77%   32-35, 40-43, 48-51, 56-59, 192-194, 230-232, 250-252, 286-288, 304-306, 357-359, 389-391, 420-423, 446-448, 458-460, 467, 500-503, 561-566, 597, 600-603
app\api\endpoints\feedback.py              48     26    46%   41-92
app\api\endpoints\monitoring.py            10      2    80%   14, 21
app\api\endpoints\pdf.py                  101     62    39%   27, 50-100, 106-107, 113-124, 130-163, 171, 176-182, 188-201
app\core\__init__.py                        0      0   100%
app\core\adaptive\__init__.py               0      0   100%
app\core\adaptive\ab_testing.py           152     11    93%   183, 220-221, 257, 336-343
app\core\adaptive\coordinator.py          132     48    64%   26-33, 57-65, 128, 177-178, 193, 217, 221-222, 226-227, 238-257, 261-263, 274-290
app\core\adaptive\doc_classifier.py        44      1    98%   84
app\core\adaptive\online_learner.py        31      5    84%   45-46, 66-68
app\core\adaptive\pattern_db.py           136     46    66%   49-53, 85-92, 121-123, 127-129, 146-147, 203-206, 222-223, 244-249, 253, 260-266, 276-283
app\core\adaptive\pattern_learner.py       63      6    90%   20, 61, 101-106, 128
app\core\adaptive\processing_rules.py      54      7    87%   82-89, 94
app\core\analytics_engine.py              214     46    79%   102-104, 195-196, 222-227, 231-256, 260-275, 288-289, 318-320, 340-353, 398-401, 405, 409-411, 416
app\core\config_manager.py                262    125    52%   60-61, 78-79, 132-138, 155-156, 162-163, 263-267, 379, 441-443, 465-467, 476-478, 482-493, 497-512, 516-540, 544-584, 588-663, 667
app\core\context_analyzer.py              199     17    91%   56, 71, 76-78, 84, 198-204, 331-332, 445, 452, 455, 486, 488, 542-543
app\core\data_models.py                    45      9    80%   47-51, 56-59
app\core\dependencies.py                  150     76    49%   29-31, 58-60, 88-90, 113-114, 116, 123, 129-151, 155-187, 201-207, 216-231, 238-243, 254-263, 269-280
app\core\factory.py                        47      0   100%
app\core\feature_engineering.py           332     80    76%   21, 70, 75, 100, 131, 138-143, 159, 200, 238-239, 243-256, 278-279, 287, 314-315, 333, 340-341, 359, 393-399, 419, 482, 496, 511-521, 527, 534-536, 540, 546, 562-576, 652-653, 657-660, 695-715, 720-729
app\core\feedback_system.py               272    103    62%   27-28, 101-115, 131-166, 178-221, 254-258, 271-272, 281-282, 287, 290, 305, 349-358, 361, 398-400, 407-409, 414, 422-427, 433-436, 469-473, 481, 511-513, 538-556, 560-567
app\core\intelligent_cache.py             373     31    92%   114-115, 135-141, 333-340, 359-360, 396, 413, 443, 445, 460-461, 490, 525-526, 546, 582-583, 596-600, 625-626, 670, 708
app\core\lithuanian_enhancements.py       124     16    87%   277, 323, 341-342, 360-361, 364-365, 368-369, 394-395, 465, 503-505
app\core\logging.py                       110     26    76%   44-55, 59-71, 87, 98, 104, 106, 196-216
app\core\memory_optimizer.py              297     51    83%   91-97, 102, 144, 241-242, 297, 329, 337, 351-356, 373-375, 421, 445, 460-476, 484-485, 525-563, 571-573, 585-586, 606-607
app\core\memory_utils.py                   23      9    61%   15, 20, 25, 30, 42-44, 49-50
app\core\ml_engine.py                     244    153    37%   33, 53-74, 83, 86, 89-90, 96-98, 102-130, 175-179, 183-209, 217, 221, 234-238, 265-322, 331-339, 345-356, 360-374, 386-451, 456-472, 476-481, 499-523
app\core\ml_integration.py                202     85    58%   20, 60, 75, 114-117, 166-168, 176-177, 181-183, 190-233, 239-261, 265-269, 277, 296, 308-352, 404-426, 430-446, 458-460, 464-466, 470-471, 477
app\core\ml_monitoring.py                 280    166    41%   39-56, 73, 114-124, 128-179, 248-251, 255-289, 293-313, 317-334, 338-386, 453-466, 470-475, 479-502, 506-507, 525-548, 552-567, 571-580, 586, 590, 594-618, 622, 626, 630-631, 635-637, 641-645, 651
app\core\ml_training_pipeline.py          147     82    44%   65-67, 82, 89-93, 107-132, 136, 140-145, 152, 166-198, 208-213, 227-244, 251-254, 258-275, 280
app\core\nlp_loader.py                     19     19     0%   1-36
app\core\performance.py                   191     19    90%   93, 153, 188, 220, 271-279, 314, 329-330, 336-340, 365, 369
app\core\performance_optimizer.py         393     99    75%   98-106, 118, 122-123, 172, 176-177, 213, 235, 256-319, 336, 389-395, 416-417, 450-451, 486-489, 570-571, 588-589, 610-616, 632-633, 686, 708-719, 728-766, 807-837, 841-843, 847-863, 877
app\core\real_time_monitor.py             310    174    44%   72, 108-110, 145-147, 166-168, 224-225, 239-251, 293-326, 330-336, 340-345, 349-381, 393-453, 457-525, 529-530, 534-538, 542-549, 553-556, 560-563, 571-582, 586-600, 604-641, 645-650, 654-655, 659-660
app\core\salutation_detector.py           143    113    21%   38-40, 44, 89, 100, 117-140, 144-185, 195-231, 236-252, 256-267, 272-304, 308-333, 341-354, 361-390
app\core\text_extraction.py               120     13    89%   89, 125-127, 164-166, 173-175, 291, 301, 308
app\core\training_data.py                 305    139    54%   43, 68-70, 82, 103-104, 109, 130-131, 138, 174-175, 182, 224-226, 254-271, 275-280, 292-333, 345-383, 432-452, 456-508, 513-530, 534-568, 572-620, 658-665, 704, 745-778, 784
app\core\validation_utils.py              188     38    80%   123-127, 137, 170-171, 186, 202, 208-213, 219-225, 241-250, 270, 275-280, 303-307, 311-315, 360-361, 366-367, 377-378, 490-499
app\database.py                            12      0   100%
app\db\migrations.py                      100     46    54%   26, 48-112, 130-131, 136-138, 160-165, 169-185, 196-197
app\dependencies.py                        25      8    68%   20, 26, 35-36, 41-45
app\main.py                                82     41    50%   26-27, 31-33, 39-50, 81-84, 90-91, 97, 102, 107, 120-153
app\models\pdf_document.py                 21      0   100%
app\pdf_processor.py                       19     13    32%   19-33
app\schemas\pdf.py                         18      0   100%
app\services\__init__.py                    0      0   100%
app\services\pdf_processor.py             272    104    62%   79, 104-166, 170-174, 187-189, 223, 289-290, 306-324, 349-353, 371-380, 389-422, 428-432, 446, 454-459, 534, 565-571, 587-591, 605-613
app\version.py                              1      0   100%
app\worker.py                              56     38    32%   43-53, 61-113
---------------------------------------------------------------------
TOTAL                                    6625   2212    67%

FAIL Required test coverage of 80% not reached. Total coverage: 66.61%
================================================ slowest 10 durations =================================================
9.96s setup    tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_anonymize_pdf_flow
9.66s setup    tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_process_pdf_success
8.06s setup    tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_anti_overredaction_of_common_words
8.03s setup    tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[MIN-KORT-98765-LT_MINISTRY_CARD-lt]
7.83s setup    tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_comprehensive_lithuanian_document_processing
7.59s setup    tests/system/test_adaptive_workflow.py::test_fixture_creation
7.34s setup    tests/system/test_adaptive_workflow.py::test_feedback_learns_and_discovers_new_pattern[EMP-ID-98765-EMPLOYEE_ID-en]
7.15s setup    tests/system/test_real_time_monitor_integration.py::test_monitoring_end_to_end
7.13s setup    tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_process_pdf_failure_on_anonymization_error
7.11s setup    tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_redaction_report_generation
=============================================== short test summary info ===============================================
SKIPPED [1] tests\api\test_pdf_endpoint.py:26: Test PDF not found at C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF\tests\samples\lithuanian_pii_document.pdf
SKIPPED [1] tests\system\test_adaptive_workflow.py:109: Skipping API test until '/api/v1/pdf/process' is implemented.
ERROR tests/test_pdf_processor.py::TestPDFProcessorUnit::test_find_personal_info - AttributeError: Mock object has no attribute 'get_patterns'
ERROR tests/test_pdf_processor.py::TestPDFProcessorUnit::test_deduplicate_with_confidence_simplified - AttributeError: Mock object has no attribute 'get_patterns'
ERROR tests/test_pdf_processor.py::TestPDFProcessorUnit::test_generate_redaction_report - AttributeError: Mock object has no attribute 'get_patterns'
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_simple_lithuanian_names_detection - AssertionError: assert 'Linas Vaitkus' in set()
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_anti_overredaction_in_technical_context - AssertionError: assert 'Vilniaus' in set()
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_anti_overredaction_of_common_words - AssertionError: assert 'summary' in {'categories': {'TIME': 1, 'lithuanian_names': 1}, 'details': {'TIME': [('99999...
FAILED tests/test_lithuanian_pii.py::TestLithuanianIntegration::test_redaction_report_generation - AssertionError: assert 'summary' in {'categories': {'TIME': 1, 'lithuanian_names': 1}, 'details': {'TIME': [('99999...
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_process_pdf_success - AssertionError: assert None == 1
FAILED tests/test_pdf_processor.py::TestPDFProcessorIntegration::test_anonymize_pdf_flow - AssertionError: No redaction annotations found.
FAILED tests/adaptive/test_pattern_learner.py::TestDiscoverAndValidatePatterns::test_low_precision_filtered - AssertionError: assert [AdaptivePatt... 46, 795019))] == []
FAILED tests/adaptive/test_pattern_learner.py::TestDiscoverAndValidatePatterns::test_insufficient_samples - AssertionError: assert [AdaptivePatt... 51, 849630))] == []
FAILED tests/system/test_real_time_monitor_integration.py::test_monitoring_end_to_end - AssertionError: No metrics were logged to the real-time monitor database.
====================== 9 failed, 259 passed, 2 skipped, 1 warning, 3 errors in 223.81s (0:03:43) ======================
(venv) PS C:\Users\tomas\Desktop\0001 DUOMENU ANALITIKA\038_AnonymPDF>